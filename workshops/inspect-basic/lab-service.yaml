ingress:
  enabled: true
  ingressClassName: "cilium"
  hosts:
    - "inspect-basic.local"

rbac:
  create: true

hub:
  readinessProbe:
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 5
    
  extraConfig:
    vscode-proxy: |
      # Configure jupyter-server-proxy to forward to code-server
      import os
      c.ServerProxy.servers = {
          'vscode': {
              'command': [
                  'code-server',
                  '--bind-addr', '0.0.0.0:8080',
                  '--auth', 'none',
                  '--disable-telemetry',
                  '/home/coder/workspace'
              ],
              'port': 8080,
              'timeout': 30,
              'launcher_entry': {
                  'title': 'VS Code'
              }
          }
      }
      # Redirect to VS Code by default
      # c.Spawner.default_url = '/vscode/'
      
singleuser:
  image:
    name: "ghcr.io/nbhdai/workshop-inspect-basic"
    tag: "tilt-hub-workshop-4"
    pullPolicy: "Always"
  
  # Key: Let JupyterHub handle the startup
  cmd: ["jupyterhub-singleuser"]
  
  # Cilium is handling networking and this is blocked by default.
  cloudMetadata:
    blockWithIptables: false

  extraEnv:
    PYTHONUNBUFFERED: "1"
    OPENAI_API_KEY: "hidden"
    OPENAI_BASE_URL: "http://ai-proxy-svc/openai/"
    GOOGLE_API_KEY: "hidden"  
    GOOGLE_BASE_URL: "http://ai-proxy-svc/gemini/"
    ANTHROPIC_API_KEY: "hidden"
    ANTHROPIC_BASE_URL: "http://ai-proxy-svc/anthropic/"
    JUPYTER_ENABLE_LAB: "no"  # We don't need JupyterLab
    
  storage:
    capacity: 1Gi
    
  cpu:
    limit: 2
    guarantee: 0.5
  memory:
    limit: 2G
    guarantee: 512M

cull:
  enabled: true
  timeout: 3600
  every: 300